<!DOCTYPE html> //Rev0.0 JHF 06-08-2025
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>QR FLUX</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
  <style>
    body {
      font-family: 'Roboto', sans-serif;
      margin: 0;
      padding: 0;
      background: #f5f5f5;
    }
    header {
      background-color: #003366;
      color: white;
      padding: 1rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    header h1 {
      font-size: 1.5rem;
      margin: 0;
      text-align: center;
      width: 100%;
    }
    main {
      padding: 1rem;
      max-width: 600px;
      margin: auto;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    label {
      margin-top: 1rem;
      display: block;
      font-weight: bold;
    }
    select, input[type="text"] {
      width: 100%;
      padding: 0.5rem;
      font-size: 1rem;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    button {
      margin-top: 1rem;
      width: 100%;
      padding: 0.75rem;
      font-size: 1rem;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    .generate-btn {
      background: #00b3b3;
      color: white;
    }
    .scan-btn {
      background: #007bff;
      color: white;
    }
    #qr {
      text-align: center;
      margin-top: 2rem;
    }
    #qr canvas {
      border: 1px solid #ccc;
      padding: 10px;
    }
    .hidden { display: none; }
    #qrTextOutput {
      margin-top: 1rem;
      text-align: center;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <header>
    <h1>Generador QR</h1>
  </header>
  <main>
    <label for="bodega">Bodega</label>
    <select id="bodega">
      <option value="B1">Bodega Principal</option>
      <option value="B3">Bodega Segunda Selección</option>
      <option value="B11">Bodega Taller</option>
      <option value="B15">Bodega Terreno</option>
      <option value="B16">Bodega Servicio Técnico</option>
    </select>

    <label for="codigo">Código</label>
    <input type="text" id="codigo" />

    <label for="sn">Número de Serie</label>
    <input type="text" id="sn" />

    <label for="marca">Marca</label>
    <select id="marca" onchange="actualizarModelos()">
      <option value="">Seleccione una marca</option>
      <option value="Keller">Keller</option>
      <option value="Nivus">Nivus</option>
      <option value="Leeg">Leeg</option>
      <option value="Endress+Hauser">Endress+Hauser</option>
      <option value="Siemens">Siemens</option>
      <option value="VEGA">VEGA</option>
      <option value="manual">Ingreso manual</option>
    </select>
    <input type="text" id="marcaManual" class="hidden" placeholder="Ingrese marca manualmente">

    <label for="modelo">Modelo</label>
    <select id="modelo"></select>
    <input type="text" id="modeloManual" class="hidden" placeholder="Ingrese modelo manualmente">

    <button class="scan-btn" onclick="startScanner()"><i class="fas fa-camera"></i> Leer QR desde cámara</button>
    <button class="generate-btn" onclick="generarQR()"><i class="fas fa-qrcode"></i> Generar código QR</button>

    <div id="qr"></div>
    <p id="qrTextOutput"></p>
    <div id="qr-reader" class="hidden" style="width: 100%; max-width: 400px; margin: auto; margin-top: 20px;"></div>
  </main>

  <script>
    const modelosPorMarca = {
      "VEGA": ["VEGACAL 62", "VEGACAL 63", "VEGACAL 64", "VEGACAP 27", "VEGACAP 62", "VEGAPOINT 11", "VEGAPOINT 21", "VEGAPOINT 23", "VEGAPOINT 24", "VEGAPOINT 31", "VEGAWELL 52", "VEGABAR 86", "VEGABAR 87", "VEGABAR 81", "VEGABAR 82", "VEGABAR 83", "VEGADIF 85"],
      "Keller": ["Series 21Y", "Series 21C", "Series 21PY", "Series 23RY", "Series 23SY", "23SY H2", "Series 25Y", "Series 23SX", "23SX H2", "Series PD-23X", "Series 33X", "Series PD-33X", "Series 35X", "Series PD-39X", "Series 41X", "Series 21 D RFID", "Series 21PHB", "Series 22DT", "Serie 26Y", "Serie 26X", "Serie 36XW", "Serie 36XW‑CTD", "Serie 36XW‑Ei", "Serie 36XiW", "Serie 36XS", "Serie 26KyX", "Serie 46X", "DCX‑22", "DCX‑22AA", "DCX‑22‑CTD", "DCX‑22AA‑CTD", "DCX‑16", "DCX‑25PVDF", "DCX‑38", "ADT1‑Tube", "ADT1‑Box", "ARC1‑Tube", "ECO2", "ECO2 Ei", "LEO1", "LEO1 Ei", "LEO2", "LEO2 Ei", "LEO3", "LEX1", "LEX1 Ei", "LEO5", "LEO Record", "LEO Record Ei", "LEO Record H2"],
      "Nivus": ["NivuBar Plus II", "NivuBar H III", "NivuBar G II", "AquaBar II", "AquaBar BS", "HydroBar G II", "UniBar E II"]
    };

    function actualizarModelos() {
      const marca = document.getElementById("marca").value;
      const modeloSelect = document.getElementById("modelo");
      const marcaManual = document.getElementById("marcaManual");
      const modeloManual = document.getElementById("modeloManual");

      modeloSelect.innerHTML = "";
      modeloManual.classList.add("hidden");

      if (marca === "manual") {
        marcaManual.classList.remove("hidden");
      } else {
        marcaManual.classList.add("hidden");
      }

      if (modelosPorMarca[marca]) {
        modelosPorMarca[marca].forEach(modelo => {
          const option = document.createElement("option");
          option.value = modelo;
          option.textContent = modelo;
          modeloSelect.appendChild(option);
        });
      }

      // Agrega opción de ingreso manual
      const manualOption = document.createElement("option");
      manualOption.value = "manual";
      manualOption.textContent = "Ingreso manual";
      modeloSelect.appendChild(manualOption);
      modeloSelect.dispatchEvent(new Event('change'));
    }

    document.getElementById("modelo").addEventListener("change", function () {
      const modeloManual = document.getElementById("modeloManual");
      if (this.value === "manual") {
        modeloManual.classList.remove("hidden");
      } else {
        modeloManual.classList.add("hidden");
      }
    });

    function generarQR() {
      const bodega = document.getElementById("bodega").value;
      const codigo = document.getElementById("codigo").value;
      const sn = document.getElementById("sn").value;
      const marca = document.getElementById("marca").value === "manual" ? document.getElementById("marcaManual").value : document.getElementById("marca").value;
      const modelo = document.getElementById("modeloManual").classList.contains("hidden") ? document.getElementById("modelo").value : document.getElementById("modeloManual").value;

      if (!bodega || !codigo || !sn || !marca || !modelo) {
        alert("Por favor, completa todos los campos.");
        return;
      }

      const texto = bodega + ";" + codigo + ";" + sn + ";" + marca + ";" + modelo;
      const qr = new QRious({
        element: document.getElementById("qrCanvas") || crearCanvas(),
        value: texto,
        size: 250
      });

      document.getElementById("qrTextOutput").textContent = texto;
    }

    function crearCanvas() {
      const canvas = document.createElement("canvas");
      canvas.id = "qrCanvas";
      document.getElementById("qr").innerHTML = "";
      document.getElementById("qr").appendChild(canvas);
      return canvas;
    }

    function onScanSuccess(decodedText) {
      const partes = decodedText.trim().split(",");
      document.getElementById("qrTextOutput").textContent = "QR leído: " + decodedText;

      if (partes.length < 3) {
        alert("QR no contiene suficientes datos.\nLeído: " + decodedText);
        return;
      }

      document.getElementById("bodega").value = partes[0];
      document.getElementById("codigo").value = partes[1];
      document.getElementById("sn").value = partes[2];

      html5QrCode.stop().then(() => {
        document.getElementById("qr-reader").classList.add("hidden");
      });
    }

    let html5QrCode;
    function startScanner() {
      document.getElementById("qr-reader").classList.remove("hidden");
      html5QrCode = new Html5Qrcode("qr-reader");
      html5QrCode.start(
        { facingMode: "environment" },
        { fps: 10, qrbox: 250 },
        onScanSuccess
      ).catch(err => {
        console.error("Error al iniciar el lector de QR", err);
      });
    }
  </script>
</body>
</html>
